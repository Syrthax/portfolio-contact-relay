name: Contact Relay

on:
  workflow_dispatch:
    inputs:
      name:
        description: "Sender name"
        required: false
        type: string
      message:
        description: "Contact message"
        required: true
        type: string

permissions:
  issues: write

jobs:
  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Create contact issue
        uses: actions/github-script@v7
        with:
          script: |
            const name = `${{ inputs.name }}` || 'Not provided';
            const message = `${{ inputs.message }}`;

            // Get the actor who triggered the workflow (the OAuth user)
            const sender = context.actor;

            const body = [
              '---',
              `**Name:** ${name}`,
              `**GitHub:** @${sender}`,
              '',
              '**Message:**',
              message,
              '',
              '---',
              '_Submitted via [sarthakg.tech](https://sarthakg.tech) contact form_'
            ].join('\n');

            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Contact from @${sender}`,
              body: body,
              labels: ['contact']
            });

            core.info(`Issue created: ${issue.data.html_url}`);

      - name: Log result
        if: always()
        run: |
          if [ "${{ job.status }}" = "success" ]; then
            echo "✅ Contact issue created successfully"
          else
            echo "❌ Failed to create contact issue"
          fi
