name: Portfolio Contact Relay

on:
  issues:
    types: [opened]

permissions:
  issues: read

jobs:
  send-email:
    runs-on: ubuntu-latest
    steps:
      - name: Send contact email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "New Portfolio Contact Message"
          to: ${{ secrets.EMAIL_USERNAME }}
          from: Portfolio Contact Relay <${{ secrets.EMAIL_USERNAME }}>
          body: |
            You received a new contact message from your portfolio site.

            ---
            Title: ${{ github.event.issue.title }}

            Message:
            ${{ github.event.issue.body }}

            ---
            Sender GitHub Username: ${{ github.event.issue.user.login }}
            Created At: ${{ github.event.issue.created_at }}
          convert_markdown: true

      - name: Log success
        if: success()
        run: echo "✅ Email sent successfully for issue #${{ github.event.issue.number }}"

      - name: Log failure
        if: failure()
        run: |
          echo "❌ Failed to send email for issue #${{ github.event.issue.number }}"
          echo "Check that EMAIL_USERNAME and EMAIL_PASSWORD secrets are configured correctly."
          echo "If using Gmail, ensure an App Password is set (not your account password)."
          exit 1
